---
// Contact.astro
// Los valores vienen de variables de entorno → nunca se exponen en el repo
const EMAILJS_PUBLIC_KEY  = import.meta.env.EMAILJS_PUBLIC_KEY;
const EMAILJS_SERVICE_ID  = import.meta.env.EMAILJS_SERVICE_ID;
const EMAILJS_TEMPLATE_ID = import.meta.env.EMAILJS_TEMPLATE_ID;
---

<section id="contacto" class="scroll-mt-20 relative bg-ink dark:bg-comic-blue border-b-[3px] border-paper dark:border-ink overflow-hidden py-20 px-6 md:px-16">

  <div class="CS_halftone-white absolute inset-0 pointer-events-none z-0 opacity-[0.04]"></div>
  <div class="CS_speed-lines absolute inset-0 pointer-events-none z-0 opacity-[0.03]"></div>

  <!-- Section label -->
  <div class="relative z-10 flex items-center gap-4 mb-12">
    <span class="font-bangers text-[13px] tracking-[3px] text-paper dark:text-ink opacity-40">06 /</span>
    <h2 class="font-bangers text-[clamp(36px,5vw,56px)] leading-none tracking-wide text-paper dark:text-ink">
      <span data-i18n="contacto.seccion">CON</span><span class="CS_contact-title-highlight relative inline-block" data-i18n="contacto.resaltado">TACTO</span>
    </h2>
    <div class="CS_zigzag-light flex-1 h-[3px] ml-2 opacity-20"></div>
  </div>

  <!-- ── GRID PRINCIPAL ── -->
  <div class="relative z-10 max-w-5xl mx-auto grid grid-cols-1 md:grid-cols-[1fr_1.4fr] gap-[3px]
              border-[3px] border-paper dark:border-ink
              shadow-[8px_8px_0_#fffbf0] dark:shadow-[8px_8px_0_#1a1a2e]
              bg-paper dark:bg-ink">

    <!-- ══ PANEL IZQUIERDO — Info + links ══ -->
    <div class="relative bg-yellow dark:bg-[#2a2a4a] p-8 flex flex-col justify-between overflow-hidden">

      <div class="absolute -top-6 -right-6 opacity-20">
        <svg viewBox="0 0 120 120" class="w-32 h-32">
          <polygon points="60,5 72,45 110,45 80,68 92,108 60,85 28,108 40,68 10,45 48,45" fill="#1a1a2e"/>
        </svg>
      </div>

      <span class="absolute font-bangers text-[120px] text-ink dark:text-paper opacity-[0.05]
                   tracking-[-4px] bottom-[-10px] left-2 pointer-events-none select-none leading-none">HI</span>

      <div class="relative z-10">
        <div class="font-bangers text-[12px] tracking-[4px] text-ink opacity-50 mb-4" data-i18n="contacto.eyebrow">
          ✦ DISPONIBLE AHORA
        </div>
        <h3 class="font-bangers text-[clamp(28px,4vw,42px)] leading-[1.1] tracking-wide text-ink dark:text-paper mb-4" data-i18n="contacto.headline">
          ¿Tienes un proyecto<br>en mente?
        </h3>
        <p class="font-quattrocento text-[14px] leading-relaxed text-ink dark:text-paper opacity-70 mb-8" data-i18n="contacto.subheadline">
          Estoy abierto a nuevas oportunidades, proyectos freelance o simplemente charlar sobre tecnología.
        </p>

        <div class="flex flex-col gap-3">

          <!-- Email -->
          <a href="mailto:mi.azuara03@gmail.com"
             class="flex items-center gap-3 border-[2.5px] border-ink dark:border-paper
                    bg-paper dark:bg-ink px-4 py-2.5
                    shadow-[3px_3px_0_#1a1a2e] dark:shadow-[3px_3px_0_#fffbf0]
                    transition-all duration-100
                    hover:-translate-x-0.5 hover:-translate-y-0.5
                    hover:shadow-[5px_5px_0_#1a1a2e] dark:hover:shadow-[5px_5px_0_#fffbf0]
                    hover:bg-yellow dark:hover:bg-yellow group">
            <div class="w-7 h-7 bg-comic-red border-[2px] border-ink flex items-center justify-center shrink-0">
              <ion-icon name="mail" class="text-white text-sm"></ion-icon>
            </div>
            <div>
              <div class="font-bangers text-[10px] tracking-[2px] text-ink dark:text-paper opacity-50 leading-none mb-0.5" data-i18n="contacto.email_label">EMAIL</div>
              <div class="font-quattrocento text-[13px] text-ink dark:text-paper group-hover:text-ink leading-none">mi.azuara03@gmail.com</div>
            </div>
            <ion-icon name="arrow-forward" class="text-ink dark:text-paper ml-auto opacity-40 group-hover:opacity-100 group-hover:translate-x-1 transition-all"></ion-icon>
          </a>

          <!-- WhatsApp -->
          <!-- <a href="https://wa.me/521XXXXXXXXXX" target="_blank"
             class="flex items-center gap-3 border-[2.5px] border-ink dark:border-paper
                    bg-paper dark:bg-ink px-4 py-2.5
                    shadow-[3px_3px_0_#1a1a2e] dark:shadow-[3px_3px_0_#fffbf0]
                    transition-all duration-100
                    hover:-translate-x-0.5 hover:-translate-y-0.5
                    hover:shadow-[5px_5px_0_#1a1a2e] dark:hover:shadow-[5px_5px_0_#fffbf0]
                    hover:bg-yellow dark:hover:bg-yellow group">
            <div class="w-7 h-7 bg-[#25d366] border-[2px] border-ink flex items-center justify-center shrink-0">
              <ion-icon name="logo-whatsapp" class="text-white text-sm"></ion-icon>
            </div>
            <div>
              <div class="font-bangers text-[10px] tracking-[2px] text-ink dark:text-paper opacity-50 leading-none mb-0.5" data-i18n="contacto.whatsapp_label">WHATSAPP</div>
              <div class="font-quattrocento text-[13px] text-ink dark:text-paper group-hover:text-ink leading-none">+52 1 XX XXXX XXXX</div>
            </div>
            <ion-icon name="arrow-forward" class="text-ink dark:text-paper ml-auto opacity-40 group-hover:opacity-100 group-hover:translate-x-1 transition-all"></ion-icon>
          </a> -->

          <!-- GitHub -->
          <a href="https://github.com/IvAzuara" target="_blank"
             class="flex items-center gap-3 border-[2.5px] border-ink dark:border-paper
                    bg-paper dark:bg-ink px-4 py-2.5
                    shadow-[3px_3px_0_#1a1a2e] dark:shadow-[3px_3px_0_#fffbf0]
                    transition-all duration-100
                    hover:-translate-x-0.5 hover:-translate-y-0.5
                    hover:shadow-[5px_5px_0_#1a1a2e] dark:hover:shadow-[5px_5px_0_#fffbf0]
                    hover:bg-yellow dark:hover:bg-yellow group">
            <div class="w-7 h-7 bg-ink dark:bg-paper border-[2px] border-ink dark:border-paper flex items-center justify-center shrink-0">
              <i class="devicon-github-original text-paper dark:text-ink text-sm"></i>
            </div>
            <div>
              <div class="font-bangers text-[10px] tracking-[2px] text-ink dark:text-paper opacity-50 leading-none mb-0.5">GITHUB</div>
              <div class="font-quattrocento text-[13px] text-ink dark:text-paper group-hover:text-ink leading-none">github.com/IvAzuara</div>
            </div>
            <ion-icon name="arrow-forward" class="text-ink dark:text-paper ml-auto opacity-40 group-hover:opacity-100 group-hover:translate-x-1 transition-all"></ion-icon>
          </a>

        </div>
      </div>

      <span class="CS_panel-label absolute top-2 left-3 font-bangers text-[11px] tracking-[2px] text-ink opacity-30">F</span>
    </div>

    <!-- ══ PANEL DERECHO — Formulario ══ -->
    <div class="relative bg-paper dark:bg-[#1e1e38] p-8 flex flex-col gap-5 overflow-hidden">

      <div class="absolute top-4 right-5 flex gap-1.5">
        <div class="w-1.5 h-1.5 rounded-full bg-ink dark:bg-paper opacity-20"></div>
        <div class="w-2 h-2 rounded-full bg-ink dark:bg-paper opacity-30"></div>
        <div class="w-2.5 h-2.5 rounded-full bg-ink dark:bg-paper opacity-40"></div>
      </div>

      <div class="font-bangers text-[13px] tracking-[3px] text-comic-red" data-i18n="contacto.form_label">// FORMULARIO</div>

      <div id="contact-form" class="flex flex-col gap-4">

        <div class="flex flex-col gap-1.5">
          <label class="font-bangers text-[11px] tracking-[3px] text-ink dark:text-paper opacity-60" data-i18n="contacto.nombre_label">NOMBRE</label>
          <input id="field-nombre" type="text" required placeholder="Tu nombre"
                 class="CS_input w-full font-quattrocento text-[14px] text-ink dark:text-paper
                        bg-paper dark:bg-ink border-[2.5px] border-ink dark:border-paper
                        px-4 py-2.5 outline-none
                        shadow-[3px_3px_0_#1a1a2e] dark:shadow-[3px_3px_0_#fffbf0]
                        focus:shadow-[4px_4px_0_#1a1a2e] dark:focus:shadow-[4px_4px_0_#fffbf0]
                        focus:-translate-x-px focus:-translate-y-px
                        transition-all duration-100 placeholder:opacity-30"/>
        </div>

        <div class="flex flex-col gap-1.5">
          <label class="font-bangers text-[11px] tracking-[3px] text-ink dark:text-paper opacity-60" data-i18n="contacto.email_form_label">EMAIL</label>
          <input id="field-email" type="email" required placeholder="mi.azuara03@gmail.com"
                 class="CS_input w-full font-quattrocento text-[14px] text-ink dark:text-paper
                        bg-paper dark:bg-ink border-[2.5px] border-ink dark:border-paper
                        px-4 py-2.5 outline-none
                        shadow-[3px_3px_0_#1a1a2e] dark:shadow-[3px_3px_0_#fffbf0]
                        focus:shadow-[4px_4px_0_#1a1a2e] dark:focus:shadow-[4px_4px_0_#fffbf0]
                        focus:-translate-x-px focus:-translate-y-px
                        transition-all duration-100 placeholder:opacity-30"/>
        </div>

        <div class="flex flex-col gap-1.5">
          <label class="font-bangers text-[11px] tracking-[3px] text-ink dark:text-paper opacity-60" data-i18n="contacto.asunto_label">ASUNTO</label>
          <input id="field-asunto" type="text" placeholder="¿En qué puedo ayudarte?"
                 class="CS_input w-full font-quattrocento text-[14px] text-ink dark:text-paper
                        bg-paper dark:bg-ink border-[2.5px] border-ink dark:border-paper
                        px-4 py-2.5 outline-none
                        shadow-[3px_3px_0_#1a1a2e] dark:shadow-[3px_3px_0_#fffbf0]
                        focus:shadow-[4px_4px_0_#1a1a2e] dark:focus:shadow-[4px_4px_0_#fffbf0]
                        focus:-translate-x-px focus:-translate-y-px
                        transition-all duration-100 placeholder:opacity-30"/>
        </div>

        <div class="flex flex-col gap-1.5">
          <label class="font-bangers text-[11px] tracking-[3px] text-ink dark:text-paper opacity-60" data-i18n="contacto.mensaje_label">MENSAJE</label>
          <textarea id="field-mensaje" required rows="4" placeholder="Cuéntame más..."
                    class="CS_input w-full font-quattrocento text-[14px] text-ink dark:text-paper
                           bg-paper dark:bg-ink border-[2.5px] border-ink dark:border-paper
                           px-4 py-2.5 outline-none resize-none
                           shadow-[3px_3px_0_#1a1a2e] dark:shadow-[3px_3px_0_#fffbf0]
                           focus:shadow-[4px_4px_0_#1a1a2e] dark:focus:shadow-[4px_4px_0_#fffbf0]
                           focus:-translate-x-px focus:-translate-y-px
                           transition-all duration-100 placeholder:opacity-30"></textarea>
        </div>

        <button id="submit-btn"
                class="font-bangers text-[18px] tracking-[3px] text-ink
                       bg-yellow border-[3px] border-ink dark:border-paper
                       px-6 py-3 self-start
                       shadow-[4px_4px_0_#1a1a2e] dark:shadow-[4px_4px_0_#fffbf0]
                       transition-all duration-100
                       hover:-translate-x-0.5 hover:-translate-y-0.5
                       hover:shadow-[6px_6px_0_#1a1a2e] dark:hover:shadow-[6px_6px_0_#fffbf0]
                       active:translate-x-[2px] active:translate-y-[2px] active:shadow-none
                       disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none">
          <span id="submit-label" data-i18n="contacto.btn_enviar">ENVIAR →</span>
        </button>

        <div id="form-feedback" class="hidden font-bangers text-[14px] tracking-[2px] px-4 py-2 border-[2px]"></div>

      </div>

      <span class="CS_panel-label absolute top-2 left-3 font-bangers text-[11px] tracking-[2px] text-ink dark:text-paper opacity-30">G</span>
    </div>

  </div>

  <!-- Footer strip -->
  <div class="relative z-10 max-w-5xl mx-auto mt-8 flex items-center justify-between">
    <span class="font-bangers text-[12px] tracking-[3px] text-paper dark:text-ink opacity-30">
      © 2024 · Mario Iván Azuara
    </span>
    <span class="font-bangers text-[12px] tracking-[2px] text-paper dark:text-ink opacity-30" data-i18n="contacto.footer_made">
      HECHO CON ☕ Y MUCHO CSS
    </span>
  </div>

</section>

<!-- EmailJS SDK -->
<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>

<script define:vars={{ EMAILJS_PUBLIC_KEY, EMAILJS_SERVICE_ID, EMAILJS_TEMPLATE_ID }}>
  import { getLang } from '../i18n/i18n';

  emailjs.init({ publicKey: EMAILJS_PUBLIC_KEY });

  const placeholders = {
    es: { nombre: 'Tu nombre', asunto: '¿En qué puedo ayudarte?', mensaje: 'Cuéntame más...' },
    en: { nombre: 'Your name', asunto: 'How can I help you?',     mensaje: 'Tell me more...' }
  };

  function updatePlaceholders() {
    const lang = getLang();
    const p = placeholders[lang];
    document.getElementById('field-nombre').placeholder  = p.nombre;
    document.getElementById('field-asunto').placeholder  = p.asunto;
    document.getElementById('field-mensaje').placeholder = p.mensaje;
  }

  updatePlaceholders();
  document.getElementById('lang-btn')?.addEventListener('click', () => {
    setTimeout(updatePlaceholders, 50);
  });

  const btn      = document.getElementById('submit-btn');
  const label    = document.getElementById('submit-label');
  const feedback = document.getElementById('form-feedback');

  btn.addEventListener('click', async () => {
    const lang    = getLang();
    const nombre  = document.getElementById('field-nombre').value.trim();
    const email   = document.getElementById('field-email').value.trim();
    const asunto  = document.getElementById('field-asunto').value.trim();
    const mensaje = document.getElementById('field-mensaje').value.trim();

    if (!nombre || !email || !mensaje) {
      feedback.textContent = lang === 'es'
        ? '⚠ Completa los campos obligatorios.'
        : '⚠ Please fill in required fields.';
      feedback.className = 'font-bangers text-[14px] tracking-[2px] px-4 py-2 border-[2px] border-yellow text-yellow';
      feedback.classList.remove('hidden');
      return;
    }

    btn.disabled = true;
    label.textContent = lang === 'es' ? 'ENVIANDO...' : 'SENDING...';
    feedback.classList.add('hidden');

    try {
      await emailjs.send(EMAILJS_SERVICE_ID, EMAILJS_TEMPLATE_ID, {
        from_name:  nombre,
        from_email: email,
        subject:    asunto || (lang === 'es' ? 'Mensaje desde portfolio' : 'Message from portfolio'),
        message:    mensaje,
        reply_to:   email,
      });

      document.getElementById('field-nombre').value  = '';
      document.getElementById('field-email').value   = '';
      document.getElementById('field-asunto').value  = '';
      document.getElementById('field-mensaje').value = '';

      feedback.textContent = lang === 'es'
        ? '✓ ¡Mensaje enviado! Te responderé pronto.'
        : "✓ Message sent! I'll get back to you soon.";
      feedback.className = 'font-bangers text-[14px] tracking-[2px] px-4 py-2 border-[2px] border-[#44cc44] text-[#44cc44]';
      feedback.classList.remove('hidden');
      label.textContent = lang === 'es' ? 'ENVIADO ✓' : 'SENT ✓';

    } catch {
      feedback.textContent = lang === 'es'
        ? '✗ Algo salió mal. Intenta de nuevo.'
        : '✗ Something went wrong. Try again.';
      feedback.className = 'font-bangers text-[14px] tracking-[2px] px-4 py-2 border-[2px] border-comic-red text-comic-red';
      feedback.classList.remove('hidden');
      btn.disabled = false;
      label.textContent = lang === 'es' ? 'ENVIAR →' : 'SEND →';
    }
  });
</script>